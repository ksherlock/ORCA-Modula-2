show time>timefile
unset exit
exists 13/m2defs
if {status} == 0
mkdir 13/m2defs
end

unset exit
exists obj
if {status} == 0
mkdir obj
end

delete 13/m2defs/=.sym
delete =.sym
delete =.ref

asm def/charset.def
asm def/memorymanag.def
asm def/common.def
asm def/ascii.def
asm def/consoleio.def
asm def/ezcommandli.def
asm def/gsbug.def
asm def/gsosinterfa.def
asm def/filesystem.def
asm def/ezfilesyste.def
asm def/inout.def
asm def/integermath.def
asm def/m2lib.def modula2=(-k)
echo -n "Make a note of the key please and press RETURN: "
input waitvar
unset waitvar
asm def/ezdump.def
asm def/notesynthes.def
asm def/numberconve.def
asm def/realconvers.def
asm def/realinout.def
asm def/scheduler.def
asm def/soundmanage.def
asm def/ezstorage.def
asm def/storage.def modula2=(-k)
echo -n "Make a note of the key please and press RETURN: "
input waitvar
unset waitvar
asm def/strings.def
asm def/terminal.def
asm def/w65c816.def
asm def/ace.def
asm def/loader.def
asm def/notesequenc.def
asm def/orcashell.def
asm def/resourceman.def
asm def/fastfilesys.def
asm def/texttools.def
asm def/midi.def
asm def/misctoolset.def
asm def/toollocator.def
asm def/fontmanager.def
asm def/quickdrawii.def
asm def/scrapmanage.def
asm def/printmanage.def
asm def/eventmanage.def
asm def/deskmanager.def
asm def/lineedit.def
asm def/windowmanag.def
asm def/listmanager.def
asm def/textedit.def
asm def/controlmana.def
asm def/dialogmanag.def
asm def/menumanager.def
asm def/standardfil.def
asm def/eztools.def
asm def/ezpaths.def
asm def/mathlib0.def
asm def/longmath.def
asm def/lists.def
asm def/listutility.def
asm def/ezstrings.def
asm def/superread.def

move =.sym 13/m2defs

delete obj/=.a obj/=.root

asm mod/common.mod      keep=obj/$
asm mod/ezstorage.mod   keep=obj/$
asm mod/strings.mod     keep=obj/$
asm mod/gsosinterfa.mod keep=obj/$
asm mod/consoleio.mod   keep=obj/$
asm mod/terminal.mod    keep=obj/$
asm mod/filesystem.mod  keep=obj/$
asm mod/ezfilesyste.mod keep=obj/$
asm mod/inout.mod       keep=obj/$
asm mod/ezdump.mod      keep=obj/$
asm mod/numberconve.mod keep=obj/$
asm mod/fastfilesys.mod keep=obj/$
asm mod/ezcommandli.mod keep=obj/$
asm mod/realconvers.mod keep=obj/$
asm mod/realinout.mod   keep=obj/$
asm mod/eztools.mod     keep=obj/$
asm mod/ezpaths.mod     keep=obj/$
asm mod/lists.mod       keep=obj/$
asm mod/listutility.mod keep=obj/$
asm mod/ezstrings.mod   keep=obj/$
asm mod/superread.mod   keep=obj/$

asm asm/mathlib.asm     keep=obj/$
asm asm/mathlib0.asm    keep=obj/$
asm asm/longmath.asm    keep=obj/$

makelib -l m2lib -r obj/consoleio.a obj/ezdump.a obj/filesystem.a 
makelib -l m2lib -r obj/gsosinterfa.a obj/inout.a obj/ezstorage.a
makelib -l m2lib -r obj/terminal.a obj/mathlib.a obj/strings.a
makelib -l m2lib -r obj/common.a obj/mathlib0.a obj/longmath.a

makelib -l m2lib -r obj/numberconve.a obj/ezfilesyste.a obj/ezpaths.a
makelib -l m2lib -r obj/fastfilesys.a obj/ezcommandli.a obj/superread.a
makelib -l m2lib -r obj/realconvers.a obj/realinout.a obj/eztools.a
makelib -l m2lib -r obj/lists.a obj/listutility.a obj/ezstrings.a

echo "Now update the key of M2Lib.ASM and Storage.ASM, and execute build2."
show time>>timefile

